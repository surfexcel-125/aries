<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Projects — Aries</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
<!-- HEADER (projects.html) -->
<header class="aries-topbar">
    <button id="aries-hamburger" class="aries-hamburger" aria-label="Open sidebar">☰</button>

    <span class="aries-title">PROJECT MANAGER</span>

    <a href="index.html" class="aries-brand">
        <img src="goat.png" alt="Aries Logo" class="aries-logo">
    </a>
</header>

<!-- Sidebar (projects.html) -->
<aside id="aries-sidebar" class="aries-sidebar hidden" role="complementary" aria-label="Project list">
  <nav class="aries-sidebar-nav aries-sidebar-content" role="navigation" aria-label="Projects"></nav>
</aside>

  <main class="page-wrapper">
    <div class="container">
      <div class="projects-bar">
        <h2 style="margin:0">MY PROJECTS</h2>
        <button id="openNewProjectModal" class="btn-primary">+ NEW</button>
      </div>

      <div id="projectsList" class="projects-list" style="margin-top:18px"></div>

      <div id="initialLoader" class="loader-panel" style="padding:24px;text-align:center;color:#666">
        <div class="loader-spinner" style="display:inline-block"></div>
        <p style="margin-top:8px">Connecting to Aries Cloud...</p>
      </div>
    </div>
  </main>

  <!-- New project modal (simple) -->
  <div id="newProjectModal" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.36);z-index:300">
    <div style="background:#fff;padding:18px;border-radius:8px;min-width:320px">
      <div style="font-weight:800;margin-bottom:8px">Create New Project</div>
      <input id="projectNameInput" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ddd" placeholder="Project name">
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="cancelProjectBtn" class="btn-ghost">Cancel</button>
        <button id="confirmProjectBtn" class="btn-primary">Create</button>
      </div>
    </div>
  </div>

  <script type="module">
    import './app.js';

    const listEl = document.getElementById('projectsList');
    const loader = document.getElementById('initialLoader');
    const modal = document.getElementById('newProjectModal');
    const input = document.getElementById('projectNameInput');
    const confirmBtn = document.getElementById('confirmProjectBtn');

    function el(tag, attrs={}, html='') {
      const e = document.createElement(tag);
      Object.keys(attrs).forEach(k => e.setAttribute(k, attrs[k]));
      e.innerHTML = html;
      return e;
    }

    function projectRow(p) {
      const row = document.createElement('div');
      row.className = 'project-row';
      row.style.margin = '14px 0';
      row.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:#f6f6f8">
          <a href="project_detail.html?id=${p.id}" style="padding:8px 12px;border-radius:999px;text-decoration:none;color:#111">${p.name}</a>
          <div><span style="padding:6px 12px;border-radius:999px;background:#eee">${p.status||'Active'}</span></div>
        </div>
      `;
      return row;
    }

    async function loadProjects() {
      try {
        const projects = await window.AriesDB.getProjects();
        loader.style.display = 'none';
        listEl.innerHTML = '';
        if (!projects.length) {
          listEl.innerHTML = '<div style="padding:24px;text-align:center;color:#666">No projects yet</div>';
          return;
        }
        projects.forEach(p => listEl.appendChild(projectRow(p)));
      } catch (err) {
        loader.innerHTML = '<p style="color:red">Failed to connect</p>';
        console.error(err);
      }
    }

    document.addEventListener('DOMContentLoaded', loadProjects);

    document.getElementById('openNewProjectModal').onclick = () => modal.classList.remove('hidden');
    document.getElementById('cancelProjectBtn').onclick = () => modal.classList.add('hidden');

    confirmBtn.onclick = async () => {
      const name = input.value.trim(); if (!name) return;
      confirmBtn.disabled = true; confirmBtn.textContent = 'Creating...';
      const id = await window.AriesDB.createProject(name);
      if (id) location.href = `project_detail.html?id=${id}`;
      else { alert('Failed to create'); confirmBtn.disabled = false; confirmBtn.textContent = 'Create'; }
    };
  </script>
</body>
</html>
