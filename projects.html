<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Projects — Aries</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>

  <header class="topbar">
    <button class="hamburger">☰</button>
    <div class="brand">PROJECT MANAGER</div>
    <img src="images/goat.png" class="logo">
  </header>

  <div class="page-wrapper">
    <div class="container">
      <div class="projects-bar">
        <h2 style="margin:0; font-family:'Sitka Small'; letter-spacing:1px;">MY PROJECTS</h2>
        <button id="openNewProjectModal" class="new-project-btn">+ NEW PROJECT</button>
      </div>

      <div id="projectsList" class="projects-list">
        <div class="loader-spinner"></div>
      </div>

      <div id="noProjects" style="display:none; padding:40px; text-align:center; color:#666;">
        No projects found. Start by creating one!
      </div>
    </div>
  </div>

  <div id="newProjectModal" class="modal-backdrop">
      <div class="modal-box">
          <div class="modal-title">Create New Project</div>
          <input type="text" id="projectNameInput" class="modal-input" placeholder="e.g. Website Redesign">
          <div class="modal-actions">
              <button id="cancelProjectBtn" class="btn-ghost">Cancel</button>
              <button id="confirmProjectBtn" class="btn-primary">Create</button>
          </div>
      </div>
  </div>

  <script type="module">
    // We import nothing here because app.js exposes window.AriesDB
    import './app.js'; 

    const listEl = document.getElementById('projectsList');
    const modal = document.getElementById('newProjectModal');
    const input = document.getElementById('projectNameInput');
    
    // 1. Load Projects
    async function load() {
        listEl.innerHTML = '<div class="loader-spinner"></div>';
        const projects = await window.AriesDB.getProjects();
        
        listEl.innerHTML = '';
        if(projects.length === 0) {
            document.getElementById('noProjects').style.display = 'block';
            return;
        }
        document.getElementById('noProjects').style.display = 'none';

        projects.forEach(p => {
            const row = document.createElement('div');
            row.className = 'project-row';
            row.innerHTML = `
                <div class="project-inner">
                    <a href="project_detail.html?id=${p.id}" class="project-pill">
                        <img src="images/goat.png" style="width:30px; border-radius:4px;">
                        ${p.name}
                    </a>
                    <div style="font-size:12px; font-weight:bold; color:#0b2830;">
                        STATUS: <span style="border:2px solid #0b2830; padding:4px 8px; border-radius:10px;">${p.status || 'ACTIVE'}</span>
                    </div>
                </div>
            `;
            listEl.appendChild(row);
        });
    }

    // 2. Event Listeners
    window.addEventListener('auth-ready', load); // Wait for login

    // Modal Logic
    document.getElementById('openNewProjectModal').onclick = () => {
        modal.classList.add('active');
        input.focus();
    };
    
    document.getElementById('cancelProjectBtn').onclick = () => modal.classList.remove('active');

    document.getElementById('confirmProjectBtn').onclick = async () => {
        const name = input.value.trim();
        if(!name) return;
        
        document.getElementById('confirmProjectBtn').textContent = "Creating...";
        const newId = await window.AriesDB.createProject(name);
        
        // Redirect to the workspace
        window.location.href = `project_detail.html?id=${newId}`;
    };
  </script>
</body>
</html>
