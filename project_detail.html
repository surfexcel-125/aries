<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Idea Visualizer — Fully Developed Premium Dark</title>
<style>
  :root{--bg:#071018;--card:#0c1216;--muted:#90a0b8;--accent:#8b5cf6;--glass: rgba(255,255,255,0.03)}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6eef8;background:linear-gradient(180deg,var(--bg),#041018);}
  header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid rgba(255,255,255,0.03)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  h1{font-size:15px;margin:0}
  main{display:flex;gap:16px;padding:16px;height:calc(100% - 72px)}
  aside{width:360px;background:linear-gradient(180deg,var(--card),#061018);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);overflow:auto}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:8px}
  textarea,input,select{width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#e6eef8}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;border:none;cursor:pointer}
  .ghost{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
  #canvasWrap{flex:1;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.03);position:relative;display:flex;flex-direction:column}
  #boardArea{flex:1;position:relative}
  svg{position:absolute;inset:0;pointer-events:none}
  .node{position:absolute;min-width:180px;padding:12px;border-radius:12px;background:linear-gradient(180deg,#0f1820,#071117);border:1px solid rgba(255,255,255,0.03);color:#e6eef8;box-shadow:0 12px 36px rgba(2,6,23,0.6);overflow:hidden}
  .node .title{font-weight:700;margin-bottom:6px}
  .node .meta{font-size:12px;color:var(--muted);line-height:1.25}
  .node img{width:100%;height:90px;border-radius:8px;object-fit:cover;margin-bottom:8px}
  .connector{width:12px;height:12px;border-radius:50%;background:var(--accent);position:absolute;right:-6px;top:50%;transform:translateY(-50%);box-shadow:0 6px 18px rgba(139,92,246,0.12)}
  .toolbar{position:absolute;right:12px;top:12px;display:flex;gap:8px;z-index:20}
  .muted{color:var(--muted)}
  footer{padding:8px 16px;border-top:1px solid rgba(255,255,255,0.02);font-size:12px;color:var(--muted);display:flex;justify-content:space-between}
</style>
</head>
<body>
<header>
  <div class="brand"><div class="logo">IV</div><div><h1>Idea Visualizer — Fully Developed</h1><div style="font-size:12px;color:var(--muted)">Mind-map · Flowchart · Drag board — Premium dark</div></div></div>
  <div style="display:flex;gap:8px;align-items:center">
    <select id="templateSelect" class="ghost">
      <option value="none">Template: none</option>
      <option value="product">Product Roadmap</option>
      <option value="trading">Trading System</option>
      <option value="startup">Startup Pitch</option>
    </select>
    <button id="saveBtn" class="ghost">Save</button>
    <button id="loadBtn" class="ghost">Load</button>
    <button id="exportPng" class="btn">Export PNG</button>
  </div>
</header>
<main>
  <aside>
    <div>
      <label>Paste / type your idea</label>
      <textarea id="ideaText" rows="6" placeholder="Describe your idea: features, goals, problems, users — Paragraphs and sentences will be parsed."></textarea>
      <div style="display:flex;gap:8px;margin-top:10px"><button id="analyzeBtn" class="btn">Analyze & Create</button><button id="clearBtn" class="ghost">Clear Board</button></div>
    </div>

    <div style="margin-top:14px">
      <label>Generation</label>
      <select id="genMode" style="margin-bottom:8px"><option value="semantic">Semantic (best)</option><option value="split">Sentence split</option><option value="keywords">Keyword-only</option></select>
      <label>Images</label>
      <select id="imageMode" style="margin-bottom:8px"><option value="none">No images</option><option value="auto">Auto-suggest</option></select>
      <label>Layout</label>
      <select id="layoutMode"><option value="radial">Radial (mind-map)</option><option value="flow">Flow (top→down)</option><option value="board">Board (grid)</option></select>
    </div>

    <div style="margin-top:14px">
      <label>Selected node</label>
      <div id="selectedInfo" class="muted">No node selected</div>
      <label style="margin-top:8px">Title</label>
      <input id="selTitle" />
      <label style="margin-top:8px">Notes</label>
      <textarea id="selNotes" rows="3"></textarea>
      <div style="display:flex;gap:8px;margin-top:10px"><button id="updateBtn" class="ghost">Update</button><button id="delBtn" class="ghost">Delete</button></div>
    </div>

    <div style="margin-top:18px">
      <h3 style="margin:0 0 8px 0">Shortcuts & Extras</h3>
      <div style="font-size:13px;color:var(--muted)">• Double-click canvas to add node · Drag nodes to reposition · Click connector then another node to link.<br>• Save stores JSON to localStorage; Load restores it.<br>• Export PNG downloads the current board as an image.</div>
    </div>
  </aside>

  <div id="canvasWrap">
    <div class="toolbar">
      <div style="background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;display:flex;gap:6px"><button id="mode-map" class="ghost">Mind-map</button><button id="mode-flow" class="ghost">Flowchart</button><button id="mode-board" class="ghost">Board</button></div>
    </div>
    <svg id="svgLayer"></svg>
    <div id="boardArea"></div>
    <footer><div>Idea Visualizer</div><div>Built for you — Premium dark</div></footer>
  </div>
</main>

<script>
(() => {
  // full-featured page script
  const state = {nodes:[],links:[],nextId:1,selected:null,mode:'map'}
  const canvas = document.getElementById('boardArea')
  const svg = document.getElementById('svgLayer')
  const ideaText = document.getElementById('ideaText')
  const analyzeBtn = document.getElementById('analyzeBtn')
  const genMode = document.getElementById('genMode')
  const imageMode = document.getElementById('imageMode')
  const layoutMode = document.getElementById('layoutMode')

  // helpers
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;') }

  function extractKeywords(text){ const words = text.toLowerCase().replace(/[^a-z0-9\s]/g,' ').split(/\s+/).filter(w=>w.length>3); const freq={}; words.forEach(w=>freq[w]=(freq[w]||0)+1); return Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,6).map(x=>x[0]) }

  function semanticParts(text){ const paragraphs = text.split(/\n\n+/).map(p=>p.trim()).filter(Boolean); let parts=[]; paragraphs.forEach(p=>{ const sentences = p.split(/[\.\n]/).map(s=>s.trim()).filter(Boolean); if(sentences.length<=2) parts.push(p); else parts.push(...sentences.slice(0,6)) }); return parts.slice(0,24) }

  function unsplashFor(q){ return 'https://source.unsplash.com/collection/928423/320x180/?' + encodeURIComponent(q) }

  // node creation
  function createNode(x,y,title,notes,thumb){ const id = 'n'+(state.nextId++); const el = document.createElement('div'); el.className='node'; el.dataset.id=id; el.style.left=(x||80)+'px'; el.style.top=(y||80)+'px'; el.innerHTML = `${thumb?'<img src="'+thumb+'"/>':''}<div class="title">${escapeHtml(title||'New idea')}</div><div class="meta">${escapeHtml(notes||'')}</div><div class="connector"></div>`; canvas.appendChild(el); makeDraggable(el); el.querySelector('.connector').addEventListener('click', e=> startConnect(id)); el.addEventListener('click', e=> selectNode(id,el)); state.nodes.push({id,el,x:parseInt(el.style.left),y:parseInt(el.style.top),title,notes,thumb}); drawLinks(); return id }

  // drag
  function makeDraggable(el){ let ox,oy,drag=false; el.addEventListener('pointerdown', e=>{ if(e.target.classList && e.target.classList.contains('connector')) return; drag=true; ox=e.clientX - el.offsetLeft; oy=e.clientY - el.offsetTop; el.setPointerCapture(e.pointerId) }); window.addEventListener('pointermove', e=>{ if(!drag) return; el.style.left=(e.clientX-ox)+'px'; el.style.top=(e.clientY-oy)+'px'; updatePos(el.dataset.id); drawLinks(); }); window.addEventListener('pointerup', ()=>drag=false) }
  function updatePos(id){ const n=state.nodes.find(n=>n.id===id); if(n){ n.x = n.el.offsetLeft; n.y = n.el.offsetTop } }

  // selection
  function selectNode(id,el){ state.selected=id; document.getElementById('selectedInfo').innerText=id; document.getElementById('selTitle').value = state.nodes.find(n=>n.id===id).title; document.getElementById('selNotes').value = state.nodes.find(n=>n.id===id).notes }
  document.getElementById('updateBtn')?.addEventListener('click', ()=>{ const id=state.selected; if(!id) return; const n=state.nodes.find(x=>x.id===id); n.title=document.getElementById('selTitle').value; n.notes=document.getElementById('selNotes').value; n.el.querySelector('.title').innerText=n.title; n.el.querySelector('.meta').innerText=n.notes })
  document.getElementById('delBtn')?.addEventListener('click', ()=>{ const id=state.selected; if(!id) return; const i=state.nodes.findIndex(n=>n.id===id); if(i>-1){ state.nodes[i].el.remove(); state.nodes.splice(i,1); state.links=state.links.filter(l=>l.from!==id&&l.to!==id); state.selected=null; drawLinks(); document.getElementById('selectedInfo').innerText='No node selected' } })

  // linking
  let connecting=null
  function startConnect(id){ connecting=id; svg.style.pointerEvents='auto'; svg.addEventListener('click', finishConnectOnce) }
  function finishConnectOnce(e){ const target = document.elementFromPoint(e.clientX,e.clientY); const nodeEl = getNodeElFromElement(target); if(nodeEl && nodeEl.dataset.id!==connecting){ linkNodes(connecting,nodeEl.dataset.id) } connecting=null; svg.style.pointerEvents='none'; svg.removeEventListener('click', finishConnectOnce); drawLinks() }
  function getNodeElFromElement(el){ while(el && el!==document){ if(el.classList && el.classList.contains('node')) return el; el=el.parentNode } return null }
  function linkNodes(a,b){ if(state.links.find(l=>l.from===a&&l.to===b)) return; state.links.push({from:a,to:b}); }

  function drawLinks(){ svg.innerHTML=''; state.links.forEach(l=>{ const na=state.nodes.find(n=>n.id===l.from); const nb=state.nodes.find(n=>n.id===l.to); if(!na||!nb) return; const aRect=na.el.getBoundingClientRect(); const bRect=nb.el.getBoundingClientRect(); const parentRect = canvas.getBoundingClientRect(); const x1=aRect.left-parentRect.left + aRect.width; const y1=aRect.top-parentRect.top + aRect.height/2; const x2=bRect.left-parentRect.left; const y2=bRect.top-parentRect.top + bRect.height/2; const path = document.createElementNS('http://www.w3.org/2000/svg','path'); const dx = Math.max(40, Math.abs(x2-x1)/2); const d = `M ${x1} ${y1} C ${x1+dx} ${y1} ${x2-dx} ${y2} ${x2} ${y2}`; path.setAttribute('d',d); path.setAttribute('stroke','rgba(139,92,246,0.9)'); path.setAttribute('fill','none'); path.setAttribute('stroke-width','2'); svg.appendChild(path); }) }

  // analyze & generate
  analyzeBtn.addEventListener('click', ()=>{
    const text = ideaText.value.trim(); if(!text) return; let parts=[]; if(genMode.value==='semantic') parts = semanticParts(text); else if(genMode.value==='keywords') parts = extractKeywords(text).map(k=>k); else parts = text.split(/\n|\.|\|/).map(s=>s.trim()).filter(Boolean);
    const layout = layoutMode.value; const cx = canvas.clientWidth/2; const cy = canvas.clientHeight/2;
    if(layout==='radial'){
      const rootId = createNode(cx-160,cy-80,parts[0]||'Idea','root', imageMode.value==='auto'?unsplashFor(parts[0]||'idea'):null)
      const step = (Math.PI*2)/(Math.max(1,parts.length-1)); let r=180; for(let i=1;i<parts.length;i++){ const a=(i-1)*step; const x=cx + Math.cos(a)*r; const y=cy + Math.sin(a)*r; const thumb = imageMode.value==='auto'?unsplashFor(parts[i]):null; const nid = createNode(x,y,parts[i],'',thumb); linkNodes(rootId,nid) }
    } else if(layout==='flow'){
      let y=40; for(let i=0;i<parts.length;i++){ const x=40 + (i%3)*320; const nid=createNode(x,y,parts[i],'', imageMode.value==='auto'?unsplashFor(parts[i]):null); if(i>0) linkNodes(state.nodes[state.nodes.length-2].id, nid); y += 140 }
    } else {
      let x=20,y=20; for(let i=0;i<parts.length;i++){ const nid=createNode(x,y,parts[i],'', imageMode.value==='auto'?unsplashFor(parts[i]):null); x+=260; if(x>canvas.clientWidth-220){ x=20; y+=180 } }
    }
    drawLinks()
  })

  // save/load
  document.getElementById('saveBtn').addEventListener('click', ()=>{ const payload = {nodes: state.nodes.map(n=>({id:n.id,x:n.x,y:n.y,title:n.title,notes:n.notes,thumb:n.thumb})), links:state.links}; localStorage.setItem('ideaBoard_v2', JSON.stringify(payload)); alert('Saved locally') })
  document.getElementById('loadBtn').addEventListener('click', ()=>{ const raw = localStorage.getItem('ideaBoard_v2'); if(!raw) return alert('No saved board'); const data = JSON.parse(raw); state.nodes.forEach(n=>n.el.remove()); state.nodes=[]; state.links=[]; data.nodes.forEach(n=>{ createNode(n.x,n.y,n.title,n.notes,n.thumb) }); data.links.forEach(l=>state.links.push(l)); drawLinks() })

  // clear
  document.getElementById('clearBtn').addEventListener('click', ()=>{ state.nodes.forEach(n=>n.el.remove()); state.nodes=[]; state.links=[]; svg.innerHTML=''; state.nextId=1 })

  // export PNG
  document.getElementById('exportPng').addEventListener('click', ()=>{
    const w = canvas.clientWidth, h = canvas.clientHeight; const tempSvg = document.createElementNS('http://www.w3.org/2000/svg','svg'); tempSvg.setAttribute('xmlns','http://www.w3.org/2000/svg'); tempSvg.setAttribute('width', w); tempSvg.setAttribute('height', h);
    const bg = document.createElementNS('http://www.w3.org/2000/svg','rect'); bg.setAttribute('width','100%'); bg.setAttribute('height','100%'); bg.setAttribute('fill','#071018'); tempSvg.appendChild(bg);
    state.links.forEach(l=>{ const na=state.nodes.find(n=>n.id===l.from); const nb=state.nodes.find(n=>n.id===l.to); if(!na||!nb) return; const aRect = na.el.getBoundingClientRect(); const bRect = nb.el.getBoundingClientRect(); const parentRect = canvas.getBoundingClientRect(); const x1 = aRect.left - parentRect.left + aRect.width; const y1 = aRect.top - parentRect.top + aRect.height/2; const x2 = bRect.left - parentRect.left; const y2 = bRect.top - parentRect.top + bRect.height/2; const path = document.createElementNS('http://www.w3.org/2000/svg','path'); const dx = Math.max(40, Math.abs(x2-x1)/2); const d = `M ${x1} ${y1} C ${x1+dx} ${y1} ${x2-dx} ${y2} ${x2} ${y2}`; path.setAttribute('d',d); path.setAttribute('stroke','#8b5cf6'); path.setAttribute('fill','none'); path.setAttribute('stroke-width','2'); tempSvg.appendChild(path); })
    state.nodes.forEach(n=>{ const fo = document.createElementNS('http://www.w3.org/2000/svg','foreignObject'); fo.setAttribute('x', n.x); fo.setAttribute('y', n.y); fo.setAttribute('width',220); fo.setAttribute('height',140); const div = document.createElement('div'); div.setAttribute('xmlns','http://www.w3.org/1999/xhtml'); div.style.cssText='font-family:Inter,Arial;color:#e6eef8;background:transparent;padding:8px;border-radius:8px;'; div.innerHTML = `<div style="font-weight:700;font-size:15px">${escapeHtml(n.title)}</div><div style="font-size:13px;color:#90a0b8">${escapeHtml(n.notes||'')}</div>`; if(n.thumb){ const img = document.createElement('img'); img.src=n.thumb; img.style.cssText='width:100%;height:80px;object-fit:cover;border-radius:6px;margin-bottom:8px'; div.insertBefore(img,div.firstChild) } fo.appendChild(div); tempSvg.appendChild(fo); })
    const str = new XMLSerializer().serializeToString(tempSvg); const img = new Image(); const blob = new Blob([str],{type:'image/svg+xml;charset=utf-8'}); const url = URL.createObjectURL(blob); img.onload = ()=>{ const c = document.createElement('canvas'); c.width = w; c.height = h; const ctx = c.getContext('2d'); ctx.fillStyle='#071018'; ctx.fillRect(0,0,w,h); ctx.drawImage(img,0,0); URL.revokeObjectURL(url); const a = document.createElement('a'); a.href = c.toDataURL('image/png'); a.download = 'idea-board.png'; a.click(); }; img.src = url;
  })

  // canvas dblclick to add
  canvas.addEventListener('dblclick', (e)=>{ const r = canvas.getBoundingClientRect(); const x = e.clientX - r.left; const y = e.clientY - r.top; createNode(x,y,'New idea',''); drawLinks(); })

  // initial sample
  createNode(220,160,'Central idea','Double-click nodes to edit (use selection panel)', null)
  createNode(520,120,'Branch A','', null)
  createNode(520,320,'Branch B','', null)
  linkNodes('n1','n2'); linkNodes('n1','n3'); drawLinks();

  // mode buttons
  document.getElementById('mode-map').addEventListener('click', ()=> setMode('map'))
  document.getElementById('mode-flow').addEventListener('click', ()=> setMode('flow'))
  document.getElementById('mode-board').addEventListener('click', ()=> setMode('board'))
  function setMode(m){ state.mode=m; document.querySelectorAll('.toolbar button').forEach(b=>b.classList.remove('active')); document.querySelector('#mode-'+(m==='map'?'map':m)).classList.add('active'); if(m==='flow') layoutFlow(); }
  function layoutFlow(){ state.nodes.forEach((n,i)=>{ const col = i%3; const row = Math.floor(i/3); n.x = 40 + col*320; n.y = 40 + row*140; n.el.style.left = n.x+'px'; n.el.style.top = n.y+'px' }); drawLinks(); }

})();
</script>
</body>
</html>
